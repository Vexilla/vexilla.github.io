<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><title></title><meta name="next-head-count" content="3"/><link rel="preload" href="/_next/static/css/9906e94f5ee9aeba18cd.css" as="style"/><link rel="stylesheet" href="/_next/static/css/9906e94f5ee9aeba18cd.css" data-n-g=""/><noscript data-n-css=""></noscript><link rel="preload" href="/_next/static/chunks/main-af8490dc560b2b449098.js" as="script"/><link rel="preload" href="/_next/static/chunks/webpack-50bee04d1dc61f8adf5b.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework.9d524150d48315f49e80.js" as="script"/><link rel="preload" href="/_next/static/chunks/commons.9528123feb626448eb3f.js" as="script"/><link rel="preload" href="/_next/static/chunks/fb0bb6908f7d73a98997cdce024407a53e35f564.b0044433c4faaffae7f2.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-f977827b030fde2873a6.js" as="script"/><link rel="preload" href="/_next/static/chunks/b0904b29b12d76437941cc114cfcfabf094ace05.56669315af8650001f52.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/documentation/recipes/caching-459322f3c758b3d1e283.js" as="script"/><style data-styled="" data-styled-version="5.2.1">*,*::before,*::after{box-sizing:border-box;}/*!sc*/
:root{-moz-tab-size:4;tab-size:4;}/*!sc*/
html{line-height:1.15;-webkit-text-size-adjust:100%;}/*!sc*/
body{margin:0;}/*!sc*/
body{font-family:system-ui,-apple-system,'Segoe UI',Roboto,Helvetica,Arial,sans-serif,'Apple Color Emoji','Segoe UI Emoji';}/*!sc*/
hr{height:0;color:inherit;}/*!sc*/
abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;}/*!sc*/
b,strong{font-weight:bolder;}/*!sc*/
code,kbd,samp,pre{font-family:ui-monospace,SFMono-Regular,Consolas,'Liberation Mono',Menlo,monospace;font-size:1em;}/*!sc*/
small{font-size:80%;}/*!sc*/
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline;}/*!sc*/
sub{bottom:-0.25em;}/*!sc*/
sup{top:-0.5em;}/*!sc*/
table{text-indent:0;border-color:inherit;}/*!sc*/
button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0;}/*!sc*/
button,select{text-transform:none;}/*!sc*/
button,[type='button'],[type='reset'],[type='submit']{-webkit-appearance:button;}/*!sc*/
::-moz-focus-inner{border-style:none;padding:0;}/*!sc*/
:-moz-focusring{outline:1px dotted ButtonText;}/*!sc*/
:-moz-ui-invalid{box-shadow:none;}/*!sc*/
legend{padding:0;}/*!sc*/
progress{vertical-align:baseline;}/*!sc*/
::-webkit-inner-spin-button,::-webkit-outer-spin-button{height:auto;}/*!sc*/
[type='search']{-webkit-appearance:textfield;outline-offset:-2px;}/*!sc*/
::-webkit-search-decoration{-webkit-appearance:none;}/*!sc*/
::-webkit-file-upload-button{-webkit-appearance:button;font:inherit;}/*!sc*/
summary{display:list-item;}/*!sc*/
blockquote,dl,dd,h1,h2,h3,h4,h5,h6,hr,figure,p,pre{margin:0;}/*!sc*/
button{background-color:transparent;background-image:none;}/*!sc*/
button:focus{outline:1px dotted;outline:5px auto -webkit-focus-ring-color;}/*!sc*/
fieldset{margin:0;padding:0;}/*!sc*/
ol,ul{list-style:none;margin:0;padding:0;}/*!sc*/
html{font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";line-height:1.5;}/*!sc*/
body{font-family:inherit;line-height:inherit;}/*!sc*/
*,::before,::after{box-sizing:border-box;border-width:0;border-style:solid;border-color:#e5e7eb;}/*!sc*/
hr{border-top-width:1px;}/*!sc*/
img{border-style:solid;}/*!sc*/
textarea{resize:vertical;}/*!sc*/
input::-webkit-input-placeholder,textarea::-webkit-input-placeholder{color:#9ca3af;}/*!sc*/
input::-moz-placeholder,textarea::-moz-placeholder{color:#9ca3af;}/*!sc*/
input:-ms-input-placeholder,textarea:-ms-input-placeholder{color:#9ca3af;}/*!sc*/
input::placeholder,textarea::placeholder{color:#9ca3af;}/*!sc*/
button,[role="button"]{cursor:pointer;}/*!sc*/
table{border-collapse:collapse;}/*!sc*/
h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit;}/*!sc*/
a{color:inherit;-webkit-text-decoration:inherit;text-decoration:inherit;}/*!sc*/
button,input,optgroup,select,textarea{padding:0;line-height:inherit;color:inherit;}/*!sc*/
pre,code,kbd,samp{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;}/*!sc*/
img,svg,video,canvas,audio,iframe,embed,object{display:block;vertical-align:middle;}/*!sc*/
img,video{max-width:100%;height:auto;}/*!sc*/
@-webkit-keyframes spin{to{-webkit-transform:rotate(360deg);-ms-transform:rotate(360deg);transform:rotate(360deg);}}/*!sc*/
@keyframes spin{to{-webkit-transform:rotate(360deg);-ms-transform:rotate(360deg);transform:rotate(360deg);}}/*!sc*/
@-webkit-keyframes ping{75%,100%{-webkit-transform:scale(2);-ms-transform:scale(2);transform:scale(2);opacity:0;}}/*!sc*/
@keyframes ping{75%,100%{-webkit-transform:scale(2);-ms-transform:scale(2);transform:scale(2);opacity:0;}}/*!sc*/
@-webkit-keyframes pulse{50%{opacity:.5;}}/*!sc*/
@keyframes pulse{50%{opacity:.5;}}/*!sc*/
@-webkit-keyframes bounce{0%,100%{-webkit-transform:translateY(-25%);-ms-transform:translateY(-25%);transform:translateY(-25%);-webkit-animationTimingFunction:cubic-bezier(0.8,0,1,1);animationTimingFunction:cubic-bezier(0.8,0,1,1);}50%{-webkit-transform:none;-ms-transform:none;transform:none;-webkit-animationTimingFunction:cubic-bezier(0,0,0.2,1);animationTimingFunction:cubic-bezier(0,0,0.2,1);}}/*!sc*/
@keyframes bounce{0%,100%{-webkit-transform:translateY(-25%);-ms-transform:translateY(-25%);transform:translateY(-25%);-webkit-animationTimingFunction:cubic-bezier(0.8,0,1,1);animationTimingFunction:cubic-bezier(0.8,0,1,1);}50%{-webkit-transform:none;-ms-transform:none;transform:none;-webkit-animationTimingFunction:cubic-bezier(0,0,0.2,1);animationTimingFunction:cubic-bezier(0,0,0.2,1);}}/*!sc*/
*{--tw-ring-inset:var(--tw-empty,/*!*/ /*!*/);--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgba(59,130,246,0.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;}/*!sc*/
*{--tw-shadow:0 0 #0000;}/*!sc*/
data-styled.g1[id="sc-global-ebylLZ1"]{content:"sc-global-ebylLZ1,"}/*!sc*/
.dAONYZ{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;font-size:1rem;line-height:1.5rem;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}/*!sc*/
@media (min-width:768px){.dAONYZ{margin-right:auto;margin-left:1rem;padding-top:0.25rem;padding-bottom:0.25rem;padding-left:1rem;border-left-width:1px;--tw-border-opacity:1;border-color:rgba(156,163,175,var(--tw-border-opacity));}}/*!sc*/
data-styled.g2[id="header__Nav-sc-1kvw7ez-0"]{content:"dAONYZ,"}/*!sc*/
.fVcqkf{margin-right:1.25rem;}/*!sc*/
.fVcqkf:hover{--tw-text-opacity:1;color:rgba(17,24,39,var(--tw-text-opacity));}/*!sc*/
data-styled.g3[id="header__InnerLink-sc-1kvw7ez-1"]{content:"fVcqkf,"}/*!sc*/
.cqVyxf{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}/*!sc*/
data-styled.g4[id="documentation-layout__PageWrapper-sc-1dwune6-0"]{content:"cqVyxf,"}/*!sc*/
.icpqeQ{padding:1rem;width:25%;overflow:scroll;position:-webkit-sticky;position:sticky;top:80px;max-height:calc(100vh - 80px);}/*!sc*/
data-styled.g5[id="documentation-layout__Sidebar-sc-1dwune6-1"]{content:"icpqeQ,"}/*!sc*/
.hjpRgy{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;--tw-bg-opacity:1;background-color:rgba(243,244,246,var(--tw-bg-opacity));border-radius:0.5rem;padding-top:1rem;padding-bottom:1rem;padding-left:2rem;padding-right:2rem;}/*!sc*/
data-styled.g6[id="documentation-layout__SidebarNav-sc-1dwune6-2"]{content:"hjpRgy,"}/*!sc*/
.duDNyi{padding-top:1rem;padding-bottom:1rem;}/*!sc*/
data-styled.g7[id="documentation-layout__SidebarLink-sc-1dwune6-3"]{content:"duDNyi,"}/*!sc*/
.ihVEny{-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;width:75%;padding:1rem;}/*!sc*/
data-styled.g8[id="documentation-layout__Content-sc-1dwune6-4"]{content:"ihVEny,"}/*!sc*/
</style></head><body><div id="__next"><div class="relative pt-32 md:pt-20 bg-white max-w-screen-lg mx-auto"><header class="text-gray-600 body-font fixed top-0 left-0 right-0 bg-white z-10"><div class="container mx-auto flex flex-wrap p-5 flex-col md:flex-row items-center max-w-screen-lg"><a class="flex title-font font-medium items-center text-gray-900 mb-4 md:mb-0" href="/"><div class="rounded-full bg-blue-500 p-2 w-12 h-12"><img class="max-h-full w-auto" src="/logo-white.svg"/></div><span class="ml-3 text-xl">Vexilla</span></a><nav class="header__Nav-sc-1kvw7ez-0 dAONYZ"><a class="header__InnerLink-sc-1kvw7ez-1 fVcqkf" href="/documentation">Documentation</a></nav><nav class="header__Nav-sc-1kvw7ez-0 dAONYZ"><a class="header__InnerLink-sc-1kvw7ez-1 fVcqkf" href="/documentation#api">API Docs</a></nav><a class="inline-flex items-center bg-gray-100 border-0 py-1 px-3 focus:outline-none hover:bg-gray-200 rounded text-base mt-4 md:mt-0" href="/app">App<svg fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="w-4 h-4 ml-1" viewBox="0 0 24 24"><path d="M5 12h14M12 5l7 7-7 7"></path></svg></a></div></header><div class="documentation-layout__PageWrapper-sc-1dwune6-0 cqVyxf"><div class="documentation-layout__Sidebar-sc-1dwune6-1 icpqeQ"><nav class="documentation-layout__SidebarNav-sc-1dwune6-2 hjpRgy"><div class="prose flex flex-col"><h3>Table of Contents</h3><ul><li><a class="documentation-layout__SidebarLink-sc-1dwune6-3 duDNyi" href="/documentation#getting-started">Getting Started</a></li><li><a class="documentation-layout__SidebarLink-sc-1dwune6-3 duDNyi" href="/documentation#client-libraries">Client Libraries</a></li><li><a class="documentation-layout__SidebarLink-sc-1dwune6-3 duDNyi" href="/documentation#config-schema">Config Schema</a></li><li><a class="documentation-layout__SidebarLink-sc-1dwune6-3 duDNyi" href="/documentation#feature-types">Feature Types</a></li><li><a class="documentation-layout__SidebarLink-sc-1dwune6-3 duDNyi" href="/documentation#recipes">Recipes</a></li></ul></div></nav></div><div class="documentation-layout__Content-sc-1dwune6-4 ihVEny prose"><h1>Caching</h1><p>On your server, you probably want to cache the Vexilla Flags and config. This can save your users time. It can save your bandwidth costs.</p><h2>Long Polling</h2><p>One quick and easy way of keeping the cache up to date is long-polling. This involves just fetching from your static hosting on an interval and updating the cache.</p><p>Be warned that this can introduce lag time between changing a flag and when it gets updated on your server/client. In most cases, that is acceptable, but entirely depends on the length of your timer.</p><p>Here is a quick example of an Express.js based server and its long-polling mechanism:</p><pre><pre style="background-color:#faf8f5;color:#3b82f6" class="jsx-2085888330 prism-code language-javascript"><div class="jsx-2085888330" style="color:#3b82f6"><span class="jsx-2085888330" style="color:#043e9c">const</span><span class="jsx-2085888330"> express </span><span class="jsx-2085888330" style="color:#063289">=</span><span class="jsx-2085888330"> </span><span class="jsx-2085888330" style="color:#645330">require</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">(</span><span class="jsx-2085888330" style="color:#043e9c">&quot;express&quot;</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">)</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">;</span><span class="jsx-2085888330"></span></div><div class="jsx-2085888330" style="color:#3b82f6"><span class="jsx-2085888330"></span><span class="jsx-2085888330" style="color:#043e9c">const</span><span class="jsx-2085888330"> app </span><span class="jsx-2085888330" style="color:#063289">=</span><span class="jsx-2085888330"> </span><span class="jsx-2085888330" style="color:#645330">express</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">(</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">)</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">;</span><span class="jsx-2085888330"></span></div><div class="jsx-2085888330" style="color:#3b82f6"><span class="jsx-2085888330"></span><span class="jsx-2085888330" style="color:#043e9c">const</span><span class="jsx-2085888330"> port </span><span class="jsx-2085888330" style="color:#063289">=</span><span class="jsx-2085888330"> </span><span class="jsx-2085888330" style="color:#063289">3000</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">;</span><span class="jsx-2085888330"></span></div><div class="jsx-2085888330" style="color:#3b82f6"><span class="jsx-2085888330" style="display:inline-block">
</span></div><div class="jsx-2085888330" style="color:#3b82f6"><span class="jsx-2085888330"></span><span class="jsx-2085888330" style="color:#043e9c">const</span><span class="jsx-2085888330"> </span><span class="jsx-2085888330">VexillaClient</span><span class="jsx-2085888330"> </span><span class="jsx-2085888330" style="color:#063289">=</span><span class="jsx-2085888330"> </span><span class="jsx-2085888330" style="color:#645330">require</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">(</span><span class="jsx-2085888330" style="color:#043e9c">&quot;@vexilla/client&quot;</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">)</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">;</span><span class="jsx-2085888330"></span></div><div class="jsx-2085888330" style="color:#3b82f6"><span class="jsx-2085888330"></span><span class="jsx-2085888330" style="color:#043e9c">const</span><span class="jsx-2085888330"> fiveMinutes </span><span class="jsx-2085888330" style="color:#063289">=</span><span class="jsx-2085888330"> </span><span class="jsx-2085888330" style="color:#063289">1000</span><span class="jsx-2085888330"> </span><span class="jsx-2085888330" style="color:#063289">*</span><span class="jsx-2085888330"> </span><span class="jsx-2085888330" style="color:#063289">60</span><span class="jsx-2085888330"> </span><span class="jsx-2085888330" style="color:#063289">*</span><span class="jsx-2085888330"> </span><span class="jsx-2085888330" style="color:#063289">5</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">;</span><span class="jsx-2085888330"></span></div><div class="jsx-2085888330" style="color:#3b82f6"><span class="jsx-2085888330" style="display:inline-block">
</span></div><div class="jsx-2085888330" style="color:#3b82f6"><span class="jsx-2085888330"></span><span class="jsx-2085888330" style="color:#043e9c">let</span><span class="jsx-2085888330"> flags </span><span class="jsx-2085888330" style="color:#063289">=</span><span class="jsx-2085888330"> </span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">{</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">}</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">;</span><span class="jsx-2085888330"></span></div><div class="jsx-2085888330" style="color:#3b82f6"><span class="jsx-2085888330" style="display:inline-block">
</span></div><div class="jsx-2085888330" style="color:#3b82f6"><span class="jsx-2085888330"></span><span class="jsx-2085888330" style="color:#043e9c">const</span><span class="jsx-2085888330"> globalVexillaClient </span><span class="jsx-2085888330" style="color:#063289">=</span><span class="jsx-2085888330"> </span><span class="jsx-2085888330" style="color:#043e9c">new</span><span class="jsx-2085888330"> </span><span class="jsx-2085888330">VexillaClient</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">(</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">{</span><span class="jsx-2085888330"></span></div><div class="jsx-2085888330" style="color:#3b82f6"><span class="jsx-2085888330">  baseUrl</span><span class="jsx-2085888330" style="color:#063289">:</span><span class="jsx-2085888330"> </span><span class="jsx-2085888330" style="color:#043e9c">&quot;https://BUCKET_NAME.s3-website-AWS_REGION.amazonaws.com&quot;</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">,</span><span class="jsx-2085888330"></span></div><div class="jsx-2085888330" style="color:#3b82f6"><span class="jsx-2085888330">  environment</span><span class="jsx-2085888330" style="color:#063289">:</span><span class="jsx-2085888330"> process</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">.</span><span class="jsx-2085888330">env</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">.</span><span class="jsx-2085888330">ENVIRONMENT</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">,</span><span class="jsx-2085888330"></span></div><div class="jsx-2085888330" style="color:#3b82f6"><span class="jsx-2085888330">  </span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">// for the global fetch, we don&#x27;t need the user or instance ID</span><span class="jsx-2085888330"></span></div><div class="jsx-2085888330" style="color:#3b82f6"><span class="jsx-2085888330">  customInstanceHash</span><span class="jsx-2085888330" style="color:#063289">:</span><span class="jsx-2085888330"> </span><span class="jsx-2085888330" style="color:#043e9c">null</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">,</span><span class="jsx-2085888330"></span></div><div class="jsx-2085888330" style="color:#3b82f6"><span class="jsx-2085888330"></span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">}</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">)</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">;</span><span class="jsx-2085888330"></span></div><div class="jsx-2085888330" style="color:#3b82f6"><span class="jsx-2085888330" style="display:inline-block">
</span></div><div class="jsx-2085888330" style="color:#3b82f6"><span class="jsx-2085888330"></span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">// first fetch</span><span class="jsx-2085888330"></span></div><div class="jsx-2085888330" style="color:#3b82f6"><span class="jsx-2085888330"></span><span class="jsx-2085888330" style="color:#645330">fetchFlags</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">(</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">)</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">;</span><span class="jsx-2085888330"></span></div><div class="jsx-2085888330" style="color:#3b82f6"><span class="jsx-2085888330" style="display:inline-block">
</span></div><div class="jsx-2085888330" style="color:#3b82f6"><span class="jsx-2085888330"></span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">// recurring fetches</span><span class="jsx-2085888330"></span></div><div class="jsx-2085888330" style="color:#3b82f6"><span class="jsx-2085888330"></span><span class="jsx-2085888330" style="color:#645330">setInterval</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">(</span><span class="jsx-2085888330">fetchFlags</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">,</span><span class="jsx-2085888330"> fiveMinutes</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">)</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">;</span><span class="jsx-2085888330"></span></div><div class="jsx-2085888330" style="color:#3b82f6"><span class="jsx-2085888330" style="display:inline-block">
</span></div><div class="jsx-2085888330" style="color:#3b82f6"><span class="jsx-2085888330">app</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">.</span><span class="jsx-2085888330" style="color:#645330">get</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">(</span><span class="jsx-2085888330" style="color:#043e9c">&quot;/hello&quot;</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">,</span><span class="jsx-2085888330"> </span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">(</span><span class="jsx-2085888330">req</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">,</span><span class="jsx-2085888330"> res</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">)</span><span class="jsx-2085888330"> </span><span class="jsx-2085888330" style="color:#063289">=&gt;</span><span class="jsx-2085888330"> </span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">{</span><span class="jsx-2085888330"></span></div><div class="jsx-2085888330" style="color:#3b82f6"><span class="jsx-2085888330">  </span><span class="jsx-2085888330" style="color:#043e9c">const</span><span class="jsx-2085888330"> localVexillaClient </span><span class="jsx-2085888330" style="color:#063289">=</span><span class="jsx-2085888330"> </span><span class="jsx-2085888330" style="color:#043e9c">new</span><span class="jsx-2085888330"> </span><span class="jsx-2085888330">VexillaClient</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">(</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">{</span><span class="jsx-2085888330"></span></div><div class="jsx-2085888330" style="color:#3b82f6"><span class="jsx-2085888330">    baseUrl</span><span class="jsx-2085888330" style="color:#063289">:</span><span class="jsx-2085888330"> </span><span class="jsx-2085888330" style="color:#043e9c">&quot;https://BUCKET_NAME.s3-website-AWS_REGION.amazonaws.com&quot;</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">,</span><span class="jsx-2085888330"></span></div><div class="jsx-2085888330" style="color:#3b82f6"><span class="jsx-2085888330">    environment</span><span class="jsx-2085888330" style="color:#063289">:</span><span class="jsx-2085888330"> process</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">.</span><span class="jsx-2085888330">env</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">.</span><span class="jsx-2085888330">ENVIRONMENT</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">,</span><span class="jsx-2085888330"></span></div><div class="jsx-2085888330" style="color:#3b82f6"><span class="jsx-2085888330">    </span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">// relies upon user being set by middleware</span><span class="jsx-2085888330"></span></div><div class="jsx-2085888330" style="color:#3b82f6"><span class="jsx-2085888330">    customInstanceHash</span><span class="jsx-2085888330" style="color:#063289">:</span><span class="jsx-2085888330"> req</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">.</span><span class="jsx-2085888330">user</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">.</span><span class="jsx-2085888330">id</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">,</span><span class="jsx-2085888330"></span></div><div class="jsx-2085888330" style="color:#3b82f6"><span class="jsx-2085888330">  </span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">}</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">)</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">;</span><span class="jsx-2085888330"></span></div><div class="jsx-2085888330" style="color:#3b82f6"><span class="jsx-2085888330" style="display:inline-block">
</span></div><div class="jsx-2085888330" style="color:#3b82f6"><span class="jsx-2085888330">  localVexillaClient</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">.</span><span class="jsx-2085888330" style="color:#645330">setFlags</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">(</span><span class="jsx-2085888330">flags</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">)</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">;</span><span class="jsx-2085888330"></span></div><div class="jsx-2085888330" style="color:#3b82f6"><span class="jsx-2085888330" style="display:inline-block">
</span></div><div class="jsx-2085888330" style="color:#3b82f6"><span class="jsx-2085888330">  </span><span class="jsx-2085888330" style="color:#043e9c">if</span><span class="jsx-2085888330"> </span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">(</span><span class="jsx-2085888330">localVexillaClient</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">.</span><span class="jsx-2085888330" style="color:#645330">should</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">(</span><span class="jsx-2085888330" style="color:#043e9c">&quot;SayHello&quot;</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">)</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">)</span><span class="jsx-2085888330"> </span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">{</span><span class="jsx-2085888330"></span></div><div class="jsx-2085888330" style="color:#3b82f6"><span class="jsx-2085888330">    res</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">.</span><span class="jsx-2085888330" style="color:#645330">send</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">(</span><span class="jsx-2085888330" style="color:#043e9c">&quot;Hello World!&quot;</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">)</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">;</span><span class="jsx-2085888330"></span></div><div class="jsx-2085888330" style="color:#3b82f6"><span class="jsx-2085888330">  </span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">}</span><span class="jsx-2085888330"> </span><span class="jsx-2085888330" style="color:#043e9c">else</span><span class="jsx-2085888330"> </span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">{</span><span class="jsx-2085888330"></span></div><div class="jsx-2085888330" style="color:#3b82f6"><span class="jsx-2085888330">    res</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">.</span><span class="jsx-2085888330" style="color:#645330">status</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">(</span><span class="jsx-2085888330" style="color:#063289">500</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">)</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">.</span><span class="jsx-2085888330" style="color:#645330">send</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">(</span><span class="jsx-2085888330" style="color:#043e9c">&quot;Something broke!&quot;</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">)</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">;</span><span class="jsx-2085888330"></span></div><div class="jsx-2085888330" style="color:#3b82f6"><span class="jsx-2085888330">  </span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">}</span><span class="jsx-2085888330"></span></div><div class="jsx-2085888330" style="color:#3b82f6"><span class="jsx-2085888330"></span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">}</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">)</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">;</span><span class="jsx-2085888330"></span></div><div class="jsx-2085888330" style="color:#3b82f6"><span class="jsx-2085888330" style="display:inline-block">
</span></div><div class="jsx-2085888330" style="color:#3b82f6"><span class="jsx-2085888330">app</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">.</span><span class="jsx-2085888330" style="color:#645330">listen</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">(</span><span class="jsx-2085888330">port</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">,</span><span class="jsx-2085888330"> </span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">(</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">)</span><span class="jsx-2085888330"> </span><span class="jsx-2085888330" style="color:#063289">=&gt;</span><span class="jsx-2085888330"> </span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">{</span><span class="jsx-2085888330"></span></div><div class="jsx-2085888330" style="color:#3b82f6"><span class="jsx-2085888330">  </span><span class="jsx-2085888330">console</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">.</span><span class="jsx-2085888330" style="color:#645330">log</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">(</span><span class="jsx-2085888330" style="color:#043e9c">`</span><span class="jsx-2085888330" style="color:#043e9c">Example app listening at http://localhost:</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">${</span><span class="jsx-2085888330">port</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">}</span><span class="jsx-2085888330" style="color:#043e9c">`</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">)</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">;</span><span class="jsx-2085888330"></span></div><div class="jsx-2085888330" style="color:#3b82f6"><span class="jsx-2085888330"></span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">}</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">)</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">;</span><span class="jsx-2085888330"></span></div><div class="jsx-2085888330" style="color:#3b82f6"><span class="jsx-2085888330" style="display:inline-block">
</span></div><div class="jsx-2085888330" style="color:#3b82f6"><span class="jsx-2085888330"></span><span class="jsx-2085888330" style="color:#043e9c">async</span><span class="jsx-2085888330"> </span><span class="jsx-2085888330" style="color:#043e9c">function</span><span class="jsx-2085888330"> </span><span class="jsx-2085888330" style="color:#645330">fetchFlags</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">(</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">)</span><span class="jsx-2085888330"> </span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">{</span><span class="jsx-2085888330"></span></div><div class="jsx-2085888330" style="color:#3b82f6"><span class="jsx-2085888330">  flags </span><span class="jsx-2085888330" style="color:#063289">=</span><span class="jsx-2085888330"> </span><span class="jsx-2085888330" style="color:#043e9c">await</span><span class="jsx-2085888330"> globalVexillaClient</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">.</span><span class="jsx-2085888330">fetchFlags</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">;</span><span class="jsx-2085888330"></span></div><div class="jsx-2085888330" style="color:#3b82f6"><span class="jsx-2085888330">  </span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">(</span><span class="jsx-2085888330" style="color:#043e9c">&quot;features.json&quot;</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">)</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">;</span><span class="jsx-2085888330"></span></div><div class="jsx-2085888330" style="color:#3b82f6"><span class="jsx-2085888330"></span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">}</span><span class="jsx-2085888330"></span></div><div class="jsx-2085888330" style="color:#3b82f6"><span class="jsx-2085888330" style="display:inline-block">
</span></div></pre></pre><h2>Lazy Loading</h2><p>This technique is very similar to the long-polling above. The main difference is that it does not continuously fetch the flags.</p><p>There are some trade-offs. You will save on bandwidth requesting the flags. However, when the cache is expired, a request pays an extra cost while waiting for the flags to update if you want them to have the latest flags.</p><p>If you are ok serving stale flags to this first user, they will just not get the update and instead the next request does. While stale data might not be ideal, a long request time could be worse in some cases such as when you have MANY feature flags.</p><pre><pre style="background-color:#faf8f5;color:#3b82f6" class="jsx-2085888330 prism-code language-javascript"><div class="jsx-2085888330" style="color:#3b82f6"><span class="jsx-2085888330" style="color:#043e9c">const</span><span class="jsx-2085888330"> express </span><span class="jsx-2085888330" style="color:#063289">=</span><span class="jsx-2085888330"> </span><span class="jsx-2085888330" style="color:#645330">require</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">(</span><span class="jsx-2085888330" style="color:#043e9c">&quot;express&quot;</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">)</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">;</span><span class="jsx-2085888330"></span></div><div class="jsx-2085888330" style="color:#3b82f6"><span class="jsx-2085888330"></span><span class="jsx-2085888330" style="color:#043e9c">const</span><span class="jsx-2085888330"> app </span><span class="jsx-2085888330" style="color:#063289">=</span><span class="jsx-2085888330"> </span><span class="jsx-2085888330" style="color:#645330">express</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">(</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">)</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">;</span><span class="jsx-2085888330"></span></div><div class="jsx-2085888330" style="color:#3b82f6"><span class="jsx-2085888330"></span><span class="jsx-2085888330" style="color:#043e9c">const</span><span class="jsx-2085888330"> port </span><span class="jsx-2085888330" style="color:#063289">=</span><span class="jsx-2085888330"> </span><span class="jsx-2085888330" style="color:#063289">3000</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">;</span><span class="jsx-2085888330"></span></div><div class="jsx-2085888330" style="color:#3b82f6"><span class="jsx-2085888330" style="display:inline-block">
</span></div><div class="jsx-2085888330" style="color:#3b82f6"><span class="jsx-2085888330"></span><span class="jsx-2085888330" style="color:#043e9c">const</span><span class="jsx-2085888330"> </span><span class="jsx-2085888330">VexillaClient</span><span class="jsx-2085888330"> </span><span class="jsx-2085888330" style="color:#063289">=</span><span class="jsx-2085888330"> </span><span class="jsx-2085888330" style="color:#645330">require</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">(</span><span class="jsx-2085888330" style="color:#043e9c">&quot;@vexilla/client&quot;</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">)</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">;</span><span class="jsx-2085888330"></span></div><div class="jsx-2085888330" style="color:#3b82f6"><span class="jsx-2085888330"></span><span class="jsx-2085888330" style="color:#043e9c">const</span><span class="jsx-2085888330"> fiveMinutes </span><span class="jsx-2085888330" style="color:#063289">=</span><span class="jsx-2085888330"> </span><span class="jsx-2085888330" style="color:#063289">1000</span><span class="jsx-2085888330"> </span><span class="jsx-2085888330" style="color:#063289">*</span><span class="jsx-2085888330"> </span><span class="jsx-2085888330" style="color:#063289">60</span><span class="jsx-2085888330"> </span><span class="jsx-2085888330" style="color:#063289">*</span><span class="jsx-2085888330"> </span><span class="jsx-2085888330" style="color:#063289">5</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">;</span><span class="jsx-2085888330"></span></div><div class="jsx-2085888330" style="color:#3b82f6"><span class="jsx-2085888330" style="display:inline-block">
</span></div><div class="jsx-2085888330" style="color:#3b82f6"><span class="jsx-2085888330"></span><span class="jsx-2085888330" style="color:#043e9c">let</span><span class="jsx-2085888330"> flags </span><span class="jsx-2085888330" style="color:#063289">=</span><span class="jsx-2085888330"> </span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">{</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">}</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">;</span><span class="jsx-2085888330"></span></div><div class="jsx-2085888330" style="color:#3b82f6"><span class="jsx-2085888330"></span><span class="jsx-2085888330" style="color:#043e9c">let</span><span class="jsx-2085888330"> lastFlagFetch </span><span class="jsx-2085888330" style="color:#063289">=</span><span class="jsx-2085888330"> </span><span class="jsx-2085888330" style="color:#063289">0</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">;</span><span class="jsx-2085888330"></span></div><div class="jsx-2085888330" style="color:#3b82f6"><span class="jsx-2085888330" style="display:inline-block">
</span></div><div class="jsx-2085888330" style="color:#3b82f6"><span class="jsx-2085888330"></span><span class="jsx-2085888330" style="color:#043e9c">const</span><span class="jsx-2085888330"> globalVexillaClient </span><span class="jsx-2085888330" style="color:#063289">=</span><span class="jsx-2085888330"> </span><span class="jsx-2085888330" style="color:#043e9c">new</span><span class="jsx-2085888330"> </span><span class="jsx-2085888330">VexillaClient</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">(</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">{</span><span class="jsx-2085888330"></span></div><div class="jsx-2085888330" style="color:#3b82f6"><span class="jsx-2085888330">  baseUrl</span><span class="jsx-2085888330" style="color:#063289">:</span><span class="jsx-2085888330"> </span><span class="jsx-2085888330" style="color:#043e9c">&quot;https://BUCKET_NAME.s3-website-AWS_REGION.amazonaws.com&quot;</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">,</span><span class="jsx-2085888330"></span></div><div class="jsx-2085888330" style="color:#3b82f6"><span class="jsx-2085888330">  environment</span><span class="jsx-2085888330" style="color:#063289">:</span><span class="jsx-2085888330"> process</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">.</span><span class="jsx-2085888330">env</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">.</span><span class="jsx-2085888330">ENVIRONMENT</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">,</span><span class="jsx-2085888330"></span></div><div class="jsx-2085888330" style="color:#3b82f6"><span class="jsx-2085888330">  </span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">// for the global fetch, we don&#x27;t need the user or instance ID</span><span class="jsx-2085888330"></span></div><div class="jsx-2085888330" style="color:#3b82f6"><span class="jsx-2085888330">  customInstanceHash</span><span class="jsx-2085888330" style="color:#063289">:</span><span class="jsx-2085888330"> </span><span class="jsx-2085888330" style="color:#043e9c">null</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">,</span><span class="jsx-2085888330"></span></div><div class="jsx-2085888330" style="color:#3b82f6"><span class="jsx-2085888330"></span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">}</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">)</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">;</span><span class="jsx-2085888330"></span></div><div class="jsx-2085888330" style="color:#3b82f6"><span class="jsx-2085888330" style="display:inline-block">
</span></div><div class="jsx-2085888330" style="color:#3b82f6"><span class="jsx-2085888330"></span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">// first fetch</span><span class="jsx-2085888330"></span></div><div class="jsx-2085888330" style="color:#3b82f6"><span class="jsx-2085888330"></span><span class="jsx-2085888330" style="color:#645330">fetchFlags</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">(</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">)</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">;</span><span class="jsx-2085888330"></span></div><div class="jsx-2085888330" style="color:#3b82f6"><span class="jsx-2085888330" style="display:inline-block">
</span></div><div class="jsx-2085888330" style="color:#3b82f6"><span class="jsx-2085888330">app</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">.</span><span class="jsx-2085888330" style="color:#645330">get</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">(</span><span class="jsx-2085888330" style="color:#043e9c">&quot;/hello&quot;</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">,</span><span class="jsx-2085888330"> </span><span class="jsx-2085888330" style="color:#043e9c">async</span><span class="jsx-2085888330"> </span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">(</span><span class="jsx-2085888330">req</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">,</span><span class="jsx-2085888330"> res</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">)</span><span class="jsx-2085888330"> </span><span class="jsx-2085888330" style="color:#063289">=&gt;</span><span class="jsx-2085888330"> </span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">{</span><span class="jsx-2085888330"></span></div><div class="jsx-2085888330" style="color:#3b82f6"><span class="jsx-2085888330">  </span><span class="jsx-2085888330" style="color:#043e9c">const</span><span class="jsx-2085888330"> localVexillaClient </span><span class="jsx-2085888330" style="color:#063289">=</span><span class="jsx-2085888330"> </span><span class="jsx-2085888330" style="color:#043e9c">new</span><span class="jsx-2085888330"> </span><span class="jsx-2085888330">VexillaClient</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">(</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">{</span><span class="jsx-2085888330"></span></div><div class="jsx-2085888330" style="color:#3b82f6"><span class="jsx-2085888330">    baseUrl</span><span class="jsx-2085888330" style="color:#063289">:</span><span class="jsx-2085888330"> </span><span class="jsx-2085888330" style="color:#043e9c">&quot;https://BUCKET_NAME.s3-website-AWS_REGION.amazonaws.com&quot;</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">,</span><span class="jsx-2085888330"></span></div><div class="jsx-2085888330" style="color:#3b82f6"><span class="jsx-2085888330">    environment</span><span class="jsx-2085888330" style="color:#063289">:</span><span class="jsx-2085888330"> process</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">.</span><span class="jsx-2085888330">env</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">.</span><span class="jsx-2085888330">ENVIRONMENT</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">,</span><span class="jsx-2085888330"></span></div><div class="jsx-2085888330" style="color:#3b82f6"><span class="jsx-2085888330">    </span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">// relies upon user being set by middleware</span><span class="jsx-2085888330"></span></div><div class="jsx-2085888330" style="color:#3b82f6"><span class="jsx-2085888330">    customInstanceHash</span><span class="jsx-2085888330" style="color:#063289">:</span><span class="jsx-2085888330"> req</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">.</span><span class="jsx-2085888330">user</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">.</span><span class="jsx-2085888330">id</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">,</span><span class="jsx-2085888330"></span></div><div class="jsx-2085888330" style="color:#3b82f6"><span class="jsx-2085888330">  </span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">}</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">)</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">;</span><span class="jsx-2085888330"></span></div><div class="jsx-2085888330" style="color:#3b82f6"><span class="jsx-2085888330" style="display:inline-block">
</span></div><div class="jsx-2085888330" style="color:#3b82f6"><span class="jsx-2085888330">  </span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">// This is the main thing that changes</span><span class="jsx-2085888330"></span></div><div class="jsx-2085888330" style="color:#3b82f6"><span class="jsx-2085888330">  </span><span class="jsx-2085888330" style="color:#043e9c">if</span><span class="jsx-2085888330"> </span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">(</span><span class="jsx-2085888330">lastFlagFetch </span><span class="jsx-2085888330" style="color:#063289">+</span><span class="jsx-2085888330"> fiveMinutes </span><span class="jsx-2085888330" style="color:#063289">&lt;</span><span class="jsx-2085888330"> </span><span class="jsx-2085888330">Date</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">.</span><span class="jsx-2085888330" style="color:#645330">now</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">(</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">)</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">)</span><span class="jsx-2085888330"> </span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">{</span><span class="jsx-2085888330"></span></div><div class="jsx-2085888330" style="color:#3b82f6"><span class="jsx-2085888330">    </span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">// update fetch timestamp</span><span class="jsx-2085888330"></span></div><div class="jsx-2085888330" style="color:#3b82f6"><span class="jsx-2085888330">    lastFlagFetch </span><span class="jsx-2085888330" style="color:#063289">=</span><span class="jsx-2085888330"> </span><span class="jsx-2085888330">Date</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">.</span><span class="jsx-2085888330" style="color:#645330">now</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">(</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">)</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">;</span><span class="jsx-2085888330"></span></div><div class="jsx-2085888330" style="color:#3b82f6"><span class="jsx-2085888330">    </span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">// update global flags</span><span class="jsx-2085888330"></span></div><div class="jsx-2085888330" style="color:#3b82f6"><span class="jsx-2085888330">    flags </span><span class="jsx-2085888330" style="color:#063289">=</span><span class="jsx-2085888330"> </span><span class="jsx-2085888330" style="color:#043e9c">await</span><span class="jsx-2085888330"> client</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">.</span><span class="jsx-2085888330" style="color:#645330">fetchFlags</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">(</span><span class="jsx-2085888330" style="color:#043e9c">&quot;features.json&quot;</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">)</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">;</span><span class="jsx-2085888330"></span></div><div class="jsx-2085888330" style="color:#3b82f6"><span class="jsx-2085888330">  </span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">}</span><span class="jsx-2085888330"></span></div><div class="jsx-2085888330" style="color:#3b82f6"><span class="jsx-2085888330" style="display:inline-block">
</span></div><div class="jsx-2085888330" style="color:#3b82f6"><span class="jsx-2085888330">  localVexillaClient</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">.</span><span class="jsx-2085888330" style="color:#645330">setFlags</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">(</span><span class="jsx-2085888330">flags</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">)</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">;</span><span class="jsx-2085888330"></span></div><div class="jsx-2085888330" style="color:#3b82f6"><span class="jsx-2085888330" style="display:inline-block">
</span></div><div class="jsx-2085888330" style="color:#3b82f6"><span class="jsx-2085888330">  </span><span class="jsx-2085888330" style="color:#043e9c">if</span><span class="jsx-2085888330"> </span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">(</span><span class="jsx-2085888330">localVexillaClient</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">.</span><span class="jsx-2085888330" style="color:#645330">should</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">(</span><span class="jsx-2085888330" style="color:#043e9c">&quot;SayHello&quot;</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">)</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">)</span><span class="jsx-2085888330"> </span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">{</span><span class="jsx-2085888330"></span></div><div class="jsx-2085888330" style="color:#3b82f6"><span class="jsx-2085888330">    res</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">.</span><span class="jsx-2085888330" style="color:#645330">send</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">(</span><span class="jsx-2085888330" style="color:#043e9c">&quot;Hello World!&quot;</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">)</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">;</span><span class="jsx-2085888330"></span></div><div class="jsx-2085888330" style="color:#3b82f6"><span class="jsx-2085888330">  </span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">}</span><span class="jsx-2085888330"> </span><span class="jsx-2085888330" style="color:#043e9c">else</span><span class="jsx-2085888330"> </span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">{</span><span class="jsx-2085888330"></span></div><div class="jsx-2085888330" style="color:#3b82f6"><span class="jsx-2085888330">    res</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">.</span><span class="jsx-2085888330" style="color:#645330">status</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">(</span><span class="jsx-2085888330" style="color:#063289">500</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">)</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">.</span><span class="jsx-2085888330" style="color:#645330">send</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">(</span><span class="jsx-2085888330" style="color:#043e9c">&quot;Something broke!&quot;</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">)</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">;</span><span class="jsx-2085888330"></span></div><div class="jsx-2085888330" style="color:#3b82f6"><span class="jsx-2085888330">  </span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">}</span><span class="jsx-2085888330"></span></div><div class="jsx-2085888330" style="color:#3b82f6"><span class="jsx-2085888330"></span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">}</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">)</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">;</span><span class="jsx-2085888330"></span></div><div class="jsx-2085888330" style="color:#3b82f6"><span class="jsx-2085888330" style="display:inline-block">
</span></div><div class="jsx-2085888330" style="color:#3b82f6"><span class="jsx-2085888330">app</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">.</span><span class="jsx-2085888330" style="color:#645330">listen</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">(</span><span class="jsx-2085888330">port</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">,</span><span class="jsx-2085888330"> </span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">(</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">)</span><span class="jsx-2085888330"> </span><span class="jsx-2085888330" style="color:#063289">=&gt;</span><span class="jsx-2085888330"> </span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">{</span><span class="jsx-2085888330"></span></div><div class="jsx-2085888330" style="color:#3b82f6"><span class="jsx-2085888330">  </span><span class="jsx-2085888330">console</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">.</span><span class="jsx-2085888330" style="color:#645330">log</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">(</span><span class="jsx-2085888330" style="color:#043e9c">`</span><span class="jsx-2085888330" style="color:#043e9c">Example app listening at http://localhost:</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">${</span><span class="jsx-2085888330">port</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">}</span><span class="jsx-2085888330" style="color:#043e9c">`</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">)</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">;</span><span class="jsx-2085888330"></span></div><div class="jsx-2085888330" style="color:#3b82f6"><span class="jsx-2085888330"></span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">}</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">)</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">;</span><span class="jsx-2085888330"></span></div><div class="jsx-2085888330" style="color:#3b82f6"><span class="jsx-2085888330" style="display:inline-block">
</span></div><div class="jsx-2085888330" style="color:#3b82f6"><span class="jsx-2085888330"></span><span class="jsx-2085888330" style="color:#043e9c">async</span><span class="jsx-2085888330"> </span><span class="jsx-2085888330" style="color:#043e9c">function</span><span class="jsx-2085888330"> </span><span class="jsx-2085888330" style="color:#645330">fetchFlags</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">(</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">)</span><span class="jsx-2085888330"> </span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">{</span><span class="jsx-2085888330"></span></div><div class="jsx-2085888330" style="color:#3b82f6"><span class="jsx-2085888330">  flags </span><span class="jsx-2085888330" style="color:#063289">=</span><span class="jsx-2085888330"> </span><span class="jsx-2085888330" style="color:#043e9c">await</span><span class="jsx-2085888330"> globalVexillaClient</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">.</span><span class="jsx-2085888330">fetchFlags</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">;</span><span class="jsx-2085888330"></span></div><div class="jsx-2085888330" style="color:#3b82f6"><span class="jsx-2085888330">  </span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">(</span><span class="jsx-2085888330" style="color:#043e9c">&quot;features.json&quot;</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">)</span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">;</span><span class="jsx-2085888330"></span></div><div class="jsx-2085888330" style="color:#3b82f6"><span class="jsx-2085888330"></span><span class="jsx-2085888330" style="color:#56563E;font-style:italic">}</span><span class="jsx-2085888330"></span></div><div class="jsx-2085888330" style="color:#3b82f6"><span class="jsx-2085888330" style="display:inline-block">
</span></div></pre></pre></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{}},"page":"/documentation/recipes/caching","query":{},"buildId":"BZfy6gPB_UpC62o995kCz","nextExport":true,"autoExport":true,"isFallback":false}</script><script nomodule="" src="/_next/static/chunks/polyfills-483e9e96b8aec87b069a.js"></script><script src="/_next/static/chunks/main-af8490dc560b2b449098.js" async=""></script><script src="/_next/static/chunks/webpack-50bee04d1dc61f8adf5b.js" async=""></script><script src="/_next/static/chunks/framework.9d524150d48315f49e80.js" async=""></script><script src="/_next/static/chunks/commons.9528123feb626448eb3f.js" async=""></script><script src="/_next/static/chunks/fb0bb6908f7d73a98997cdce024407a53e35f564.b0044433c4faaffae7f2.js" async=""></script><script src="/_next/static/chunks/pages/_app-f977827b030fde2873a6.js" async=""></script><script src="/_next/static/chunks/b0904b29b12d76437941cc114cfcfabf094ace05.56669315af8650001f52.js" async=""></script><script src="/_next/static/chunks/pages/documentation/recipes/caching-459322f3c758b3d1e283.js" async=""></script><script src="/_next/static/BZfy6gPB_UpC62o995kCz/_buildManifest.js" async=""></script><script src="/_next/static/BZfy6gPB_UpC62o995kCz/_ssgManifest.js" async=""></script></body></html>